
New patches:

[unrevert
anon**20110830053827
 Ignore-this: 59c367cd643810032232961ff5246a94
] {
hunk ./GUI/Histogram.hs 143
       histogramWin   = HistogramView{..}
 
   ------------------------------------------------------------------------
-  -- Porgram the callback for the capability drawingArea
+  -- Porgram the callback for the capability labelDrawingArea
   timelineLabelDrawingArea `onExpose` \_ -> do
hunk ./GUI/Histogram.hs 145
-    traces <- readIORef tracesIORef
+{-    traces <- readIORef tracesIORef
     showLabels <- readIORef showLabelsIORef
hunk ./GUI/Histogram.hs 147
-    updateLabelDrawingArea histogramState showLabels traces
+    updateLabelDrawingArea histogramState showLabels traces -}
     return True
 
   ------------------------------------------------------------------------
hunk ./GUI/Histogram.hs 187
   onAdjChanged   timelineAdj  $ queueRedrawHistograms histogramState
   onAdjChanged   timelineVAdj $ queueRedrawHistograms histogramState
 
+  -- Porgram the callback for the capability drawingArea
   on timelineDrawingArea exposeEvent $ do
      exposeRegion <- New.eventRegion
      liftIO $ do
hunk ./GUI/Histogram.hs 206
            cursor    <- readIORef cursorIORef
            bookmarks <- readIORef bookmarkIORef
 
-           renderView histogramState params' hecs cursor bookmarks exposeRegion
+           renderViewHistogram histogramState params' hecs cursor bookmarks exposeRegion
 
      return True
 
hunk ./GUI/Histogram.hs 223
 queueRedrawHistograms :: TimelineState -> IO ()
 queueRedrawHistograms TimelineState{..} = do
   widgetQueueDraw timelineDrawingArea
-  widgetQueueDraw timelineLabelDrawingArea
+--  widgetQueueDraw timelineLabelDrawingArea
 
 --FIXME: we are still unclear about which state changes involve which updates
 histogramParamsChanged :: HistogramView -> IO ()
hunk ./GUI/Histogram.hs 229
 histogramParamsChanged histogramWin@HistogramView{histogramState} = do
   queueRedrawHistograms histogramState
-  updateHistogramVScroll histogramWin
+--  updateHistogramVScroll histogramWin
 
 configureHistogramDrawingArea :: HistogramView -> IO ()
 configureHistogramDrawingArea histogramWin@HistogramView{histogramState} = do
hunk ./GUI/Timeline/Render.hs 4
 {-# LANGUAGE NamedFieldPuns #-}
 module GUI.Timeline.Render (
     renderView,
+    renderViewHistogram,  --TODO: move elsewhere
     renderTraces,
     updateLabelDrawingArea,
     calculateTotalTimelineHeight,
hunk ./GUI/Timeline/Render.hs 26
 import Graphics.UI.Gtk
 import Graphics.Rendering.Cairo
 import Graphics.UI.Gtk.Gdk.GC (GC, gcNew) --FIXME: eliminate old style drawing
+import qualified Graphics.Rendering.Chart as Chart
+import qualified Graphics.Rendering.Chart.Renderable as ChartR
+import qualified Graphics.Rendering.Chart.Gtk as ChartG
 
 import Data.IORef
 import Control.Monad
hunk ./GUI/Timeline/Render.hs 32
+import Data.Accessor
 
 -------------------------------------------------------------------------------
 
hunk ./GUI/Timeline/Render.hs 107
       renderBookmarks bookmarks params
       drawCursor cursor_t params
 
+-------------------------------------------------------------------------------
+-- | This function redraws the currently visible part of the
+--   main trace canvas plus related canvases.
+--
+renderViewHistogram ::
+  TimelineState
+           -> ViewParameters
+           -> HECs -> Timestamp -> [Timestamp]
+           -> Region -> IO ()
+renderViewHistogram
+  TimelineState{timelineDrawingArea, timelineVAdj, timelinePrevView}
+           params hecs cursor_t bookmarks exposeRegion = do
+
+  -- Get state information from user-interface components
+  (dAreaWidth, _) <- widgetGetSize timelineDrawingArea
+  vadj_value <- adjustmentGetValue timelineVAdj
+
+  prev_view <- readIORef timelinePrevView
+
+  rect <- regionGetClipbox exposeRegion
+
+  let plot xs =
+              let layout = Chart.layout1_plots ^= [ Left (Chart.plotBars bars) ]
+                           $ Chart.defaultLayout1 :: Chart.Layout1 Double Double
+
+                  bars = Chart.plot_bars_values ^= barvs
+                         $ Chart.defaultPlotBars
+
+                  barvs = [(intDoub t, [intDoub height]) | (t, height) <- xs]
+
+                  intDoub :: Integral a => a -> Double
+                  intDoub = fromIntegral
+              in layout
+  ChartG.updateCanvas (ChartR.toRenderable (plot (durHistogram hecs))) timelineDrawingArea >> return ()
+
+{-
+updateCanvas  :: Renderable a -> G.DrawingArea  -> IO Bool
+updateCanvas chart canvas = do
+    win <- G.widgetGetDrawWindow canvas
+    (width, height) <- G.widgetGetSize canvas
+    let sz = (fromIntegral width,fromIntegral height)
+    G.renderWithDrawable win $ runCRender (render chart sz) bitmapEnv
+    return True
+
+  win <- widgetGetDrawWindow timelineDrawingArea
+  renderWithDrawable win $ do
+
+  let renderToNewSurface = do
+        new_surface <- withTargetSurface $ \surface ->
+                         liftIO $ createSimilarSurface surface ContentColor
+                                    dAreaWidth (height params)
+        renderWith new_surface $ do
+             clearWhite
+             renderTracesHistogram params hecs rect
+        return new_surface
+
+  surface <-
+    case prev_view of
+      Nothing -> renderToNewSurface
+
+      Just (old_params, surface)
+         | old_params == params
+         -> return surface
+
+         | width  old_params == width  params &&
+           height old_params == height params
+         -> do
+               if old_params { hadjValue = hadjValue params } == params
+                  -- only the hadjValue changed
+                  && abs (hadjValue params - hadjValue old_params) <
+                     fromIntegral (width params) * scaleValue params
+                  -- and the views overlap...
+                  then do
+                       scrollView surface old_params params hecs
+
+                  else do
+                       renderWith surface $ do
+                          clearWhite; renderTracesHistogram params hecs rect
+                       return surface
+
+         | otherwise
+         -> do surfaceFinish surface
+               renderToNewSurface
+
+  liftIO $ writeIORef timelinePrevView (Just (params, surface))
+
+  region exposeRegion
+  clip
+  setSourceSurface surface 0 (-vadj_value)
+          -- ^^ this is where we adjust for the vertical scrollbar
+  setOperator OperatorSource
+  paint
+  when (scaleValue params > 0) $
+    withViewScale params $ do
+      renderBookmarks bookmarks params
+      drawCursor cursor_t params
+-}
+
 -------------------------------------------------------------------------------
 
 renderBookmarks :: [Timestamp] -> ViewParameters -> Render ()
hunk ./GUI/Timeline/Render.hs 303
       zipWithM_ renderTrace viewTraces (traceYPositions labelsMode viewTraces)
 
 -------------------------------------------------------------------------------
+-- This function draws the current view of all the HECs with Cairo
+
+renderTracesHistogram :: ViewParameters -> HECs -> Rectangle
+             -> Render ()
+
+renderTracesHistogram params@ViewParameters{..} hecs (Rectangle rx _ry rw _rh)
+  = do
+    let
+        scale_rx    = fromIntegral rx * scaleValue
+        scale_rw    = fromIntegral rw * scaleValue
+        scale_width = fromIntegral width * scaleValue
+
+        startPos :: Timestamp
+        startPos = fromIntegral (max 0 (truncate (scale_rx + hadjValue)))
+                   -- hadj_value might be negative, as we leave a
+                   -- small gap before the trace starts at the beginning
+
+        endPos :: Timestamp
+        endPos = minimum [
+                   ceiling (max 0 (hadjValue + scale_width)),
+                   ceiling (max 0 (hadjValue + scale_rx + scale_rw)),
+                   hecLastEventTime hecs
+                ]
+    return ()
+    {-
+    -- Now render the timeline drawing if we have a non-empty trace
+    when (scaleValue > 0) $ do
+      withViewScale params $ do
+        let plot xs =
+              let layout = layout1_plots ^= [ Left (plotBars bars) ]
+                           $ defaultLayout1 :: Layout1 Double Double
+
+                  bars = plot_bars_values ^= barvs
+                         $ defaultPlotBars
+
+                  barvs = [(intDoub t, [intDoub height]) | (t, height) <- xs]
+
+                  intDoub :: Integral a => a -> Double
+                  intDoub = fromIntegral
+              in layout
+        return () -- renderableToPNGFile (toRenderable (plot (durHistogram hecs))) 1024 400 out
+
+      save
+      -- First render the ticks and tick times
+      renderTicks startPos endPos scaleValue height
+      restore
+
+      -- This function helps to render a single HEC...
+      let
+        renderTrace trace y = do
+            save
+            translate 0 (fromIntegral y)
+            case trace of
+               TraceHEC c ->
+                 let (dtree, etree, _) = hecTrees hecs !! c
+                 in renderHEC c params startPos endPos (dtree, etree)
+               SparkCreationHEC c ->
+                 let (_, _, stree) = hecTrees hecs !! c
+                     maxV = maxSparkValue hecs
+                 in renderSparkCreation params startPos endPos stree maxV
+               SparkConversionHEC c ->
+                 let (_, _, stree) = hecTrees hecs !! c
+                     maxV = maxSparkValue hecs
+                 in renderSparkConversion params startPos endPos stree maxV
+               SparkPoolHEC c ->
+                 let (_, _, stree) = hecTrees hecs !! c
+                     maxP = maxSparkPool hecs
+                 in renderSparkPool params startPos endPos stree maxP
+               TraceActivity ->
+                   renderActivity params hecs startPos endPos
+               _   ->
+                   return ()
+            restore
+       -- Now rennder all the HECs.
+      zipWithM_ renderTrace viewTraces (traceYPositions labelsMode viewTraces)
+-}
+-------------------------------------------------------------------------------
 
 -- parameters differ only in the hadjValue, we can scroll ...
 scrollView :: Surface
}

Context:

[add cabal dependencies needed for histogram
Mikolaj Konarski <mikolaj@well-typed.com>**20110830053634
 Ignore-this: ebb0f5147badff253d05e459ccbf1b9e
] 
[fix wrong comments
Mikolaj Konarski <mikolaj@well-typed.com>**20110830053439
 Ignore-this: ee35d3fae0b8e13fada6abfd158ef387
] 
[update TODO with histogram items
Mikolaj Konarski <mikolaj@well-typed.com>**20110830050523
 Ignore-this: 1fa3d11b6cf399bce83a7936a3e976dd
] 
[plug in sjanssen's histogram data generation code
Mikolaj Konarski <mikolaj@well-typed.com>**20110829104530
 Ignore-this: 698cd6c1fabf0fb9459c1b8354b86540
] 
[copy-paste Timeline tab to Histogram tab
Mikolaj Konarski <mikolaj@well-typed.com>**20110827132148
 Ignore-this: 90a909a0066ce83166accfca8d4741b8
] 
[let the "Timeline" pane have tabs (for spark histograms, etc.)
Mikolaj Konarski <mikolaj@well-typed.com>**20110827102547
 Ignore-this: 54e2e2dea32a8b8db9bf3b7384b4c0ce
] 
[merge threadscope-sparkgraph-demo TODO into ThreadScope TODO
Mikolaj Konarski <mikolaj@well-typed.com>**20110809083257
 Ignore-this: 9eed300d914ebab7f7a8c309e4b10610
] 
[a temporary fix for "Spark poo" in labels area with some fonts
Mikolaj Konarski <mikolaj@well-typed.com>**20110809080652
 Ignore-this: cf5df0ee098d0b0676614eeb01f0979
] 
[add some new bug reports to TODO
mikolaj.konarski@gmail.com**20110808085857
 Ignore-this: 2e4283193e11c7d09ac871052443d5ec
] 
[clean up the TODO file
mikolaj.konarski@gmail.com**20110808085258
 Ignore-this: 115b0b472a2d87a8303e7dbecdfe7868
] 
[move back to using pool size durations centered around samples; add justification
mikolaj.konarski@gmail.com**20110808081401
 Ignore-this: 6c6d5cf84a888b4eb8a3d727a9b64880
] 
[fix no redraw of horizontal dashed lines when zoomed in
mikolaj.konarski@gmail.com**20110808080445
 Ignore-this: b5ce410247c88b844346a9d00590f9b8
] 
[fix a crash when redrawing right ends of graphs
mikolaj.konarski@gmail.com**20110808080335
 Ignore-this: 2b91e3845610b3e61ee45c5c84be6e9b
] 
[resolve the patch conflict from the refactoring and the in-code docs improvement
mikolaj.konarski@gmail.com**20110805073654
 Ignore-this: 684d3e1e897c212d64f93e4996bd1bb2
] 
[improve documentation of spark rendering
mikolaj.konarski@gmail.com**20110702145256
 Ignore-this: c672077024b937517add136746352ed5
] 
[improve documentation and layout of SparTree.hs
mikolaj.konarski@gmail.com**20110702142623
 Ignore-this: 25dbbcee5293f512d66ec5564a118bfb
] 
[clarify "spark duration" and change semantics to match description
mikolaj.konarski@gmail.com**20110702114928
 Ignore-this: 120655f02d1df7c7d9082b6203d1c654
] 
[explain the semantics of spark stat operations
mikolaj.konarski@gmail.com**20110701234239
 Ignore-this: 67bb45800faaa3312ca58b3cdb93f45a
] 
[clarify the function of the zeroed spark stats
mikolaj.konarski@gmail.com**20110701214922
 Ignore-this: 71ceea2e0638f03fc76ec18ec9e50605
] 
[make all the itroduced types private
mikolaj.konarski@gmail.com**20110701202545
 Ignore-this: 372b821591d4578b83058311064dad95
] 
[Move the spark rendering code into its own module
Duncan Coutts <duncan@well-typed.com>**20110718204940
 Ignore-this: eb8fa94b79998d24f62c3923f77ae54a
] 
[Add labels for the new spark graphs
Duncan Coutts <duncan@well-typed.com>**20110718202956
 Ignore-this: 5698609393a972cc24ae7948cf0bfcbe
] 
[Draw the new spark events as instant events in the HEC timelines
Duncan Coutts <duncan@well-typed.com>**20110718202650
 Ignore-this: ed994999bee45731d0c53ac432051c8c
] 
[Sort out the metadata in the .cabal file
Duncan Coutts <duncan@well-typed.com>**20110718152247
 Ignore-this: aee195356d8d43aa37b13acdfa41505
] 
[Update to match latest ghc-events api version
Duncan Coutts <duncan@well-typed.com>**20110718151250
 Ignore-this: caafda64790f285448b7bf6148fc3db6
] 
[fix spurious blue lines by drawing vertical scales only at timeline start
mikolaj.konarski@gmail.com**20110629150901
 Ignore-this: 26fc8c51bd58dd978044c13006593a77
] 
[fix spark transition rate units: now it's spark/ms
mikolaj.konarski@gmail.com**20110629145439
 Ignore-this: ca7f8d97a3e7e7b0f2cf1c02a4934ad6
] 
[move spark graph colour definitions to ViewerColours.hs
mikolaj.konarski@gmail.com**20110629142349
 Ignore-this: 327915501244d2620c5e9a0db0472cfd
] 
[tweak spark graph colours
mikolaj.konarski@gmail.com**20110629140714
 Ignore-this: 9522302faf95a803da3a2b55cc4d2949
] 
[snap the graph height to the nearest even int, if big enough
mikolaj.konarski@gmail.com**20110629113603
 Ignore-this: c2e972338f8686a9763c8e804927ccfd
] 
[avoid printing the 0 tick value, since it often overwrites the graph
mikolaj.konarski@gmail.com**20110629113509
 Ignore-this: 927442f80685f743e6c4f28e00eb856d
] 
[change tick colour to blue, to be distinct from the graph outline colour
mikolaj.konarski@gmail.com**20110629113352
 Ignore-this: 8749a83f14eca0213c4b76c80868c5b
] 
[add numbers to the ticks for the spark graph scales
mikolaj.konarski@gmail.com**20110629112231
 Ignore-this: 19f5f51aa546880115b1aef26ff083ec
] 
[add little ticks to spark graph scales
mikolaj.konarski@gmail.com**20110629011527
 Ignore-this: f4188174847e75ecf30e9541e7f8f7d5
] 
[start implementing vertical scales for spark graphs
mikolaj.konarski@gmail.com**20110628225717
 Ignore-this: 42b867acaafbfca02ff5d427491c04c5
] 
[change colours of spark graph areas
mikolaj.konarski@gmail.com**20110628140548
 Ignore-this: e94720590b13803c15f6fbce46aa1ec9
] 
[reorder spark conversion graphs
mikolaj.konarski@gmail.com**20110628135601
 Ignore-this: e415e0dc204690dd525b7527ea4e67dd
] 
[make spark pool mean more accurate (but not yet weighted nor resampled)
mikolaj.konarski@gmail.com**20110627193734
 Ignore-this: 6fc5f3f27d52716274eec0c1b6a90e28
] 
[fix extrapolating pool size values after sample data ends
mikolaj.konarski@gmail.com**20110627153119
 Ignore-this: fa9b05bf7de8cde868cbe8d60bb4bea6
] 
[clean up data representation: spark stats only for deltas
mikolaj.konarski@gmail.com**20110627140357
 Ignore-this: cc6fca4f5ca1ae504ed91a776b4ef3c7
 (previously spar stats (or spark counters) were also used for absolute
 values at point, in addition to deltas of the values over intervals
] 
[change colours of spark pool size graph
mikolaj.konarski@gmail.com**20110627114937
 Ignore-this: 5258676e18c9b72507f936e77188f9d6
] 
[complete demo-grade spark pool size rendering
mikolaj.konarski@gmail.com**20110627112839
 Ignore-this: 43bdb99f5709367c9db7012cbfd9e34d
] 
[rename spark stats operations to reflect they are not raw log data
mikolaj.konarski@gmail.com**20110625233409
 Ignore-this: 7deb018c321c6129d32a5841d10f9e2e
] 
[rename SparkCounters to SparkStats, for pool size
mikolaj.konarski@gmail.com**20110625232955
 Ignore-this: 224b1ea89a0d6ae93802bf4adb7f10af
] 
[remove the endT field of spark counter durations (YAGNI)
mikolaj.konarski@gmail.com**20110625223321
 Ignore-this: 42445d5e50fa98aefe126bfed3803dd2
] 
[remove the absolute values from spark tree leaves; unneeded for pool size
mikolaj.konarski@gmail.com**20110625222244
 Ignore-this: 890d1a163b0b430b89b09548a2a53e91
] 
[visualiza rate of spark pool size change, for testing
mikolaj.konarski@gmail.com**20110625220117
 Ignore-this: 92195ff37c3e88ae0f50cc87beda271
] 
[add a mock-up of the pool size graph
mikolaj.konarski@gmail.com**20110625212013
 Ignore-this: 799a127e38e6fb33284507f04a3bdeb
] 
[switch SparkCounters from Word64 to Double to fix broken zoom in
mikolaj.konarski@gmail.com**20110625104412
 Ignore-this: c457ed6f8780302e194b9f0da4297203
] 
[refactor spark graph scaling to use spark per slice instead of per pixel
mikolaj.konarski@gmail.com**20110625092721
 Ignore-this: a43c9f0b44e27fd1c372656fb9249b71
] 
[refactor spark graphs now that they all have the same scale
mikolaj.konarski@gmail.com**20110625092408
 Ignore-this: 8f022594997edff32961e7c377867cd6
] 
[draw the outline exactly line Activity graph draws it (not 1 pixel above)
mikolaj.konarski@gmail.com**20110625012425
 Ignore-this: b1e01de5b7df40fd47647ebd004eab4f
] 
[remove a few parameters that I don't use for a long time now
mikolaj.konarski@gmail.com**20110625004853
 Ignore-this: a3eeec8742f0e56d5d5b527ebca74b9b
] 
[calculate spark graph scale globally for all graphs and HECs
mikolaj.konarski@gmail.com**20110625004042
 Ignore-this: 9bbd064dbfa3a1529c83570c395c804e
] 
[fix (one-liner) to the wrong, high plateaus when GC is rare
mikolaj.konarski@gmail.com**20110625001432
 Ignore-this: 10c4f2377eb13806baa595b377ac0918
] 
[calculate spark_per_pixel for each HEC and graph stack separately
mikolaj.konarski@gmail.com**20110624122933
 Ignore-this: 43c5cffc403be63c7a759d64415e7953
] 
[get rid of the hack compensating for line width difference
mikolaj.konarski@gmail.com**20110624120531
 Ignore-this: 32c561624ddfec9154bb1e5b65e199f5
 Apparently, lines look differently when they are drawn after filling a region
 than when they are drawn before. The fact that the line is being drawn
 1 pixel above the filled region does not change anything. Cairo must do
 some aggresive antialiasing or there is a bug with fill that causes it to
 overwrite pixels outside the desired area.
] 
[make spark_per_pixel, etc., local to the graph stack, not global
mikolaj.konarski@gmail.com**20110624115826
 Ignore-this: 62c325fd381098d820a2237bc9cc6758
] 
[add drawing of a black line, 1 pixel above the outline of spark areas
mikolaj.konarski@gmail.com**20110624112412
 Ignore-this: 77e37fdc0f472b744d2f6b78b8275269
] 
[fix zoom and arithmetics
mikolaj.konarski@gmail.com**20110621164821
 Ignore-this: 91ffa532828afd4eb72fd82f4878eb3e
] 
[add filling area under graphs with solid colours; TODO: clean zoom
mikolaj.konarski@gmail.com**20110621154630
 Ignore-this: 3b33e2b9816b232bda9a445f2a192a87
] 
[add spark creation graph, separately
mikolaj.konarski@gmail.com**20110621122528
 Ignore-this: ed8c760d236e1dea301a712170c561d3
] 
[add 3 stacked graphs of spark conversion; TODO: fill
mikolaj.konarski@gmail.com**20110621113354
 Ignore-this: e90945fa72b5bf1ba177cd8e7a170231
] 
[move spark graphs out of trace graphs, into a separate block
mikolaj.konarski@gmail.com**20110621002223
 Ignore-this: 57fddfacd2c6e8da50f12306c8520f6
] 
[refactor: reorder functions chronologically
mikolaj.konarski@gmail.com**20110620113236
 Ignore-this: 12bc0b12e6a94948a997650fc31546fa
] 
[refactor: move SparkCounters to a separate file
mikolaj.konarski@gmail.com**20110620112623
 Ignore-this: 1703690a3be1e363bfb1fd51d001136a
] 
[plug in SparkTrees for rendering, plenty decisions to make now
mikolaj.konarski@gmail.com**20110620105549
 Ignore-this: 3c378887f7eaa0bdebb3db16cd7b0b2
] 
[more precisely approximate values for slices crossing borders of tree nodes
mikolaj.konarski@gmail.com**20110620105407
 Ignore-this: 27af79635be3377960ff3e06a89a5177
] 
[refactor and generalize SparkCounters operations
mikolaj.konarski@gmail.com**20110620105202
 Ignore-this: 447419d0a52c898a64ffd3ecda3f4200
] 
[plug spark trees in; stop at rendering
mikolaj.konarski@gmail.com**20110618102016
 Ignore-this: 8b6d0b2fa05fff83fee5289fd64204bc
] 
[make available a few more basic spark tree operations
mikolaj.konarski@gmail.com**20110618101909
 Ignore-this: fa57254c55dd2bcabbe24523649d9bf8
] 
[add the query to the spark tree, giving deltas of spark transtions
mikolaj.konarski@gmail.com**20110618092110
 Ignore-this: 1ec772da5d5600d35292b094ccd7c190
] 
[add filtering out events urelated to spark trees
mikolaj.konarski@gmail.com**20110617214716
 Ignore-this: 5216df44f7516acd03c67fc7b3780d4a
] 
[add the spark trees to the cabal config
mikolaj.konarski@gmail.com**20110617201653
 Ignore-this: e591b4c69edac9983eafd4fdd6b3b64
] 
[whitespace fix for the cabal file
mikolaj.konarski@gmail.com**20110617180515
 Ignore-this: 5ad0262dc044ac4912aac4f9ea085aa
] 
[datatype of tree of spark counters and it's constructor
mikolaj.konarski@gmail.com**20110617180100
 Ignore-this: d8dbb1c8fbeca4bc7d5fd79821e1e3b0
] 
[Turns out we need gtk-0.12
Duncan Coutts <duncan@well-typed.com>**20110602152304
 Ignore-this: 2c6c52489591d254f442bb3abcde68f5
] 
[fix cut-and-pasto (Save as PNG was saving a PDF)
Simon Marlow <marlowsd@gmail.com>**20110526123341
 Ignore-this: 2d81e85e6cb4723bac99428ee842f4a4
] 
[Bump the version number
Duncan Coutts <duncan@well-typed.com>**20110509182723
 Ignore-this: 1859ad1fee6519370e30eb6d8067d3e4
] 
[Add myself as an author
Duncan Coutts <duncan@well-typed.com>**20110509182027
 Ignore-this: f593b13de32b632218d79d3b3b191117
] 
[Add GUI sync calls so that the progress window is displayed
Duncan Coutts <duncan@well-typed.com>**20110509181640
 Ignore-this: 7238ac8ef22bc3075d9ff6d6f466eb50
 Otherwise the thread scheduling can mean that the background processing
 goes on for too long while the GUI is not being updated.
] 
[Fix input focus for events and timeline views
Duncan Coutts <duncan@well-typed.com>**20110509181620
 Ignore-this: e23c44206862cc38562b1a66c3dae824
] 
[Change the main window state/event handling to use an event loop and queue
Duncan Coutts <duncan@well-typed.com>**20110509180808
 Ignore-this: cf676e7c272eccc039a12f7cf0d52331
 That is, rather than the state being in a bunch of IORefs, have a single
 recursive event loop function that keeps the state as function paramaters
 and recieves events and performs update actions.
] 
[Simplify redraw/update patch for timeline zoom
Duncan Coutts <duncan@well-typed.com>**20110507230034
 Ignore-this: 912b53acb12867228d0bbcc33c1b5bff
] 
[Synchronise the cursor in the events view and timeline
Duncan Coutts <duncan@well-typed.com>**20110507224626
 Ignore-this: 68e551081ecc30db9af2cc655037013d
] 
[Move definition of HECs types to Events.HECs
Duncan Coutts <duncan@well-typed.com>**20110507224217
 Ignore-this: 1e15d7aad42da955a38e01b43e9340a4
 It is not GUI specific.
] 
[Rewrite the events view
Duncan Coutts <duncan@well-typed.com>**20110507141038
 Ignore-this: 754c0afce14cc75cd485a2c6991c0b93
 All of the visual rendering, the behaviour, state management and interface.
] 
[Move the timeline key into the sidebar
Duncan Coutts <duncan@well-typed.com>**20110504120009
 Ignore-this: 977e30a9e9a7c5995cf1586eff7ac5e9
] 
[Fix up timeline key bindings
Duncan Coutts <duncan@well-typed.com>**20110504104428
 Ignore-this: 26bfc712c1b53d9405804f82478e95ca
] 
[Separate the TimelineView from the TimelineState
Duncan Coutts <duncan@well-typed.com>**20110503225119
 Ignore-this: 987f840416756a75ceef942315d6be44
 The TimelineState should eventually be eliminated.
] 
[Move more of the state handling into the main Timeline module
Duncan Coutts <duncan@well-typed.com>**20110503205843
 Ignore-this: 22a1af36541a28ec796e5e2368bc7bd3
 rather than having it in the Render module too. Ideally the render module
 should be stateless and just render based on paramaters passed.
] 
[Stop exporting some now-unused timeline state change notification functions
Duncan Coutts <duncan@well-typed.com>**20110503194039
 Ignore-this: aa7afc893beb9fbefe37831fee5a9403
] 
[Add a TODO
Duncan Coutts <duncan@well-typed.com>**20110503193700
 Ignore-this: 30db20a1807a40b7619a266aa883b551
] 
[Handle the display label mode state properly
Duncan Coutts <duncan@well-typed.com>**20110503193611
 Ignore-this: c36deb1b8843ee023575855081a58483
] 
[Merge a couple tiny modules
Duncan Coutts <duncan@well-typed.com>**20110503191711
 Ignore-this: 57413d4b9d808a2d2accdde793a95e0e
 Each only had one function that was only used in one place.
] 
[Remove the little remaining debug code
Duncan Coutts <duncan@well-typed.com>**20110503183338
 Ignore-this: bf53ac86281de5e0bb215e1efdaf13c8
] 
[Unshare the cursor state
Duncan Coutts <duncan@well-typed.com>**20110503182804
 Ignore-this: 67bde2c65c821482b8d4c407f9eeccf3
 Now separate in the events and timeline views.
 Managed at the top level in main.
] 
[Unshare the bookmark state
Duncan Coutts <duncan@well-typed.com>**20110503175332
 Ignore-this: 873c32f7d4ac1d3e6f2ab9074ab2290d
 The bookmark state is owned by the BookmarkView and changes
 are sent to the Timeline
] 
[Make a new TraceView component and separate the trace state in the Timeline
Duncan Coutts <duncan@well-typed.com>**20110430003528
 Ignore-this: a4218c6cf1b0c97b0ccc23a0f8844520
 Now the TraceView and Timeline have separate private states relating
 to the traces, along with public functions to set the state.
] 
[Move control over visibility of sidebar and events view to the MainWindow
Duncan Coutts <duncan@well-typed.com>**20110429233757
 Ignore-this: 33346c7e2e60bd584e2f47f00ac379c0
] 
[Fix a bug with the filename not being set on file load
Duncan Coutts <duncan@well-typed.com>**20110429205121
 Ignore-this: cccab06d20381172d91d5297b413ad02
] 
[Give the TimelineView a private hecsIORef and scaleIORef
Duncan Coutts <duncan@well-typed.com>**20110429204943
 Ignore-this: 68e656a6fe6c593952a8b87303ed9924
 And a proper update function.
] 
[Use MainWindow as a Gtk.Window and hide underlying Window widget
Duncan Coutts <duncan@well-typed.com>**20110429202832
 Ignore-this: 65afd52579ed13de9f034235504bbabd
 Make MainWindow an instance of the Gtk.WindowClass so it can be passed
 where a  Window is required, e.g. when constructing dialogs.
 This gives us slightly better encapsulation for the MainWindow module.
] 
[Move the getViewParameters to the Timeline module
Duncan Coutts <duncan@well-typed.com>**20110429202426
 Ignore-this: 649bd2b329ad193a11c845ff338738d
] 
[Rename the GUI.State module to GUI.Types
Duncan Coutts <duncan@well-typed.com>**20110429200234
 Ignore-this: 4d4f9befacf6a3c25f65ed4b2af58a11
 It doesn't contain any state anymore.
] 
[Eliminate the ViewerState type
Duncan Coutts <duncan@well-typed.com>**20110429195918
 Ignore-this: ea8555c84fc5934b4ab02996d8db5f94
 The remaining state components are used only by the Timeline modules.
] 
[Remove debug code from the EventsWindow
Duncan Coutts <duncan@well-typed.com>**20110429122349
 Ignore-this: f4326c326bbabde76a9003d03ea26674
] 
[Remove shared state from the EventsWindow
Duncan Coutts <duncan@well-typed.com>**20110429122336
 Ignore-this: 76dcfee413786bf1a8f09b11379763a3
 Still to be done is to sync up the cursor position of the events window
 and the timeline window.
] 
[Note more explicitly which ViewerState items are used where
Duncan Coutts <duncan@well-typed.com>**20110428200626
 Ignore-this: ecf6596a887cb39db5adb38f0155252c
] 
[Remove now-redundant code and state entries
Duncan Coutts <duncan@well-typed.com>**20110428195725
 Ignore-this: b56360a283613d3b018b3978ce28cd3c
] 
[Remove some now-redundant state parameters
Duncan Coutts <duncan@well-typed.com>**20110428193809
 Ignore-this: e19c6337bacb5dc9d7b5402e183d0b01
] 
[Add a FIXME about use of old style Gdk.GC drawing
Duncan Coutts <duncan@well-typed.com>**20110428193329
 Ignore-this: 11f7fbbb862f71d41d5f1727bccf1b59
 We should be using cairo instead.
] 
[The ReadEvents now return results rather than updating the GUI directly
Duncan Coutts <duncan@well-typed.com>**20110428190650
 Ignore-this: 507f1ca21d04995c733d20689775400b
 The GUI.Main is now responsible for making the state changes and
 updating the GUI once the data has been loaded.
] 
[Eliminate another shared widget
Duncan Coutts <duncan@well-typed.com>**20110428185143
 Ignore-this: 8d642438ae6cfaa358c991aa22b782d0
] 
[Move updating of the main window titlebar and statusbar to the right place
Duncan Coutts <duncan@well-typed.com>**20110428185045
 Ignore-this: 4005727a33faeedb03fa87c5b0f8402c
] 
[Change the way we handle the progress bar for the file loading
Duncan Coutts <duncan@well-typed.com>**20110428161144
 Ignore-this: 6a1c99b14c4a834811a823cb38d3172b
 Better separation and no more dialogRun nonsense.
] 
[Pass value paramaters to the saveAs functions
Duncan Coutts <duncan@well-typed.com>**20110428140400
 Ignore-this: 3243d040543ea662986864ee8d28d8b
 Rather than passing references to various bits of mutable state.
] 
[Stop the shared use of another IORef
Duncan Coutts <duncan@well-typed.com>**20110428115036
 Ignore-this: fdffab5d9218915ccfd21b6c2c0a80fc
] 
[Merge the two SaveAs modules into one
Duncan Coutts <duncan@well-typed.com>**20110428114214
 Ignore-this: b7f602405343d1cc2235baba36c90776
] 
[Update the EventsWindow after loading a file
Duncan Coutts <duncan@well-typed.com>**20110427170057
 Ignore-this: 927a3907c0c0aa063787d35bc9cdc626
 Previously this only worked by accident. There was no proper mechanism
 for notifying the events view after mutating the underlying model state.
 Note: this is only a temporary fix to make it work ok. The long term
 solution is in the rest of the refactoring.
] 
[Split GUI.Main into actions part and view part
Duncan Coutts <duncan@well-typed.com>**20110427165627
 Ignore-this: ddd561d4b6c78230ade4986662fe110b
 The new GUI.MainWindow is the view part that just deals with constructing
 the view and setting up actions for events. The actual handlers remain in
 the GUI.Main module.
] 
[Remove debug trace code that violates layering
Duncan Coutts <duncan@well-typed.com>**20110423104056
 Ignore-this: 92221dae51cef09cd6a92f515f3f591
] 
[Refactor timeline module to increase encapsulation
Duncan Coutts <duncan@well-typed.com>**20110423103648
 Ignore-this: 4e56152bef0d9b745cedef639c5e2fba
 Not yet complete, it still uses the ViewerState but not directly,
 it now only passes it on to other modules that still use it.
] 
[Postpone file loading until after the main window is displayed
Duncan Coutts <duncan@well-typed.com>**20110423094854
 Ignore-this: 9db9ac625b5d92299ba0cef5e128918b
 This is more standard GUI behaviour.
 (It also happens to help with some  other refactoring)
] 
[Set the zoom/scroll button handlers in the GUI main, not the timeline
Duncan Coutts <duncan@well-typed.com>**20110422174248
 Ignore-this: daf6cd9f4926945ecd3659b62db7e8ff
 This eliminate a few more widgets from the global shared state.
 Export appropriate methods from Timeline. The Timeline module still
 needs encapsulating properly.
] 
[Remove shared widget timelineHScrollbar and timelineVScrollbar
Duncan Coutts <duncan@well-typed.com>**20110422171957
 Ignore-this: 8630aa79b5260a4da294e1a1e19ff5fd
] 
[Remove another widget from the shared state
Duncan Coutts <duncan@well-typed.com>**20110422163612
 Ignore-this: 51de71541f39f2cab9e6a764ae1348ef
] 
[Refactor events window to be better encapsulated
Duncan Coutts <duncan@well-typed.com>**20110422160957
 Ignore-this: 87662bef8184d6c1d6af70bf01c1d099
 But still need to eliminate a couple shared IORefs
] 
[Remove dead code and unnecessary exports from EventsWindow
Duncan Coutts <duncan@well-typed.com>**20110422143633
 Ignore-this: eb22680657b663eede476d95dbe09147
] 
[Refactor Sidebar module to be better encapsulated
Duncan Coutts <duncan@well-typed.com>**20110422110912
 Ignore-this: 734110727449b1e08cd75d0d08427853
 Now longer uses the global ViewerState and no longer depends on GUI.Timeline.
 Just interacts with its caller via event/action callbacks and methods.
 Only remaining TODO is the TreeStore which is still shared with the Traces.
] 
[Remove some more redundant imports and dead code
Duncan Coutts <duncan@well-typed.com>**20110422094435
 Ignore-this: 14a94564ac6976cf3ca7ed06d7077bee
] 
[Merge buildInitialState with startup to avoid leaking state
Duncan Coutts <duncan@well-typed.com>**20110422093504
 Ignore-this: 47fe21d58769411a8c61651702594eea
 We want to minimise the number of shared mutable objects in the
 ViewerState record. The split in the construction phase meant that
 many mutable objects that were only used during construction were
 passed via the ViewerState which then made them available to the
 rest of the program.
] 
[Further separate the command line main from the GUI main
Duncan Coutts <duncan@well-typed.com>**20110421165126
 Ignore-this: a0cc6086d803690d8751834e3b0445b8
] 
[Move option parsing into Main
Duncan Coutts <duncan@well-typed.com>**20110421164035
 Ignore-this: 64724ea63d50a7ee43dac1b41ea8f76e
 Rather than several modules depending on Options and passing these
 options about, do all the option handlign up front and pass down to
 other modules just the info they need.
] 
[Split command line and graphical parts of Main
Duncan Coutts <duncan@well-typed.com>**20110421163051
 Ignore-this: 2802360c1a35129654162813f08f60d1
] 
[Add a .eventlog filter to the file open dialog
Duncan Coutts <duncan@well-typed.com>**20110421162132
 Ignore-this: 3afb99d06d4dfb8014b5abfa94e7c9e
] 
[Amalgamate dialogs into one module and improve code
Duncan Coutts <duncan@well-typed.com>**20110421162129
 Ignore-this: 4077dd3f94f15a0a583174a4bb985d2a
 Using dialogRun is not such a good idea. It's better to deal with the
 asyncronous nature of dialog results directly than to start nesting
 calls to the main loop.
] 
[Use a new method of cooperative scheduling with gtk
Duncan Coutts <duncan@well-typed.com>**20110421135620
 Ignore-this: b894f2ec5075e2dd87c02d90bfed2efa
 Allows us to use forkIO threads anywhere
 which in turn will enable greater modularity.
] 
[Remove some redundant imports
Duncan Coutts <duncan@well-typed.com>**20110421120327
 Ignore-this: f96eaa0a8d3ed409a6e8ed5b4b12ff1a
] 
[Remove tabs, excess whitespace and fix inconsistent dos/unix text formats
Duncan Coutts <duncan@well-typed.com>**20110421120326
 Ignore-this: 3787a752e1f9eecb1079fba28175359f
] 
[Move modules into related groups
Duncan Coutts <duncan@well-typed.com>**20110421120315
 Ignore-this: 719c412531212cb056391eba4a221d88
] 
[TAG 0.1.3
Spencer Janssen <spencer@well-typed.com>**20110404162547
 Ignore-this: d9c8f30c59008bcfe5121c6a0f0c964d
] 
[Bump containers dependency
Spencer Janssen <spencer@well-typed.com>**20110404162534
 Ignore-this: 51ecfb77cffec4088761adc054085ee
] 
[TAG 0.1.3
Spencer Janssen <spencer@well-typed.com>**20110331163056
 Ignore-this: d4a9e9b21c171d0cd0772e9101cd73a
] 
[Bump version to 0.1.3
Spencer Janssen <spencer@well-typed.com>**20110331163028
 Ignore-this: 207c38d4b45bb2a7f64029d6d4bee44e
] 
[Allow the events view to be hidden, via the View mensu
Duncan Coutts <duncan@well-typed.com>**20110420194737
 Ignore-this: c638c5003525738d969c1a40add800b1
 Events view is shown by default but can be turned on/off from the view menu.
] 
[Use more kosher method of showin/hiding sidebar
Duncan Coutts <duncan@well-typed.com>**20110420193822
 Ignore-this: c62dc9daba82dcb59ccb810f683ef47
] 
[Clamp ranges on scrollbars better
Duncan Coutts <duncan@well-typed.com>**20110420181141
 Ignore-this: 5ad5ccd0c17a1a7ad774af1ccebb2260
] 
[Add back menu bar tool tips
Duncan Coutts <duncan@well-typed.com>**20110420175821
 Ignore-this: 9c75cfa0f91ea27377bd01d53223c576
 Lost in the Glade XML -> GtkBuilder XML conversion
] 
[Rearrange the main timeline and events views, and the menubars
Duncan Coutts <duncan@well-typed.com>**20110420172626
 Ignore-this: ff5d5c3b8b0bdf1ca3868a741c3e6b54
 Instead of being in two tabs, they are now visible simultaneously,
 one above the other.
 There is now one global menu bar, rather than one for each tab.
 The beginning/center/end buttons now control both the timeline and
 event views simultaneously (they were previously independent).
 A few UI tweaks: use of frames, padding. In the timeline view, the
 legend and the side labels are now inside the frame and scrollbars.
] 
[Change sidebar to use tabs rather than a combobox
Duncan Coutts <duncan@well-typed.com>**20110420121941
 Ignore-this: b2b228477241d213eee09a622d362a9e
 Also fix View->Sidebar menu, and reorder "Jump to" tool button.
] 
[Switch from glade to the new gtk builder
Duncan Coutts <duncan@well-typed.com>**20110420100613
 Ignore-this: 8ab873aa30cb7ca0c41bb8f9380df9bb
 Removes dependency on glade, but depends on slighlty more recent gtk.
] 
[Suppress unused do binding warnings
Duncan Coutts <duncan@well-typed.com>**20110420100458
 Ignore-this: 8eb3e2af2f4090f656daee46d132c7b1
] 
[Add GHC 7.0 flags and refactor
Spencer Janssen <spencer@well-typed.com>**20110330191618
 Ignore-this: 645ee33a32ece50b4f7c9bb6cbea14ae
] 
[Work around cairo-0.12.0 bug
Spencer Janssen <spencer@well-typed.com>**20110330191554
 Ignore-this: 9b4b903e31380b6b5e703334f3521843
] 
[Rename ppEvent to avoid conflict with ghc-events 0.3
Spencer Janssen <spencer@well-typed.com>**20110330191551
 Ignore-this: 203244a7cd3b64cf2a0d4059f0cc6b1c
] 
[About dialog: get current version from threadscope.cabal
Spencer Janssen <spencer@well-typed.com>**20110330191446
 Ignore-this: fb591749587a77f9ef57f24a34af979c
] 
[TAG 0.1.2
Simon Marlow <marlowsd@gmail.com>**20100526204935
 Ignore-this: d04bf0d3d66fd70d72554f2963aba692
] 
Patch bundle hash:
10478ffb3021fc8de146f8334c80168d9ee37207
